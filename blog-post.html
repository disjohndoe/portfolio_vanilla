<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/dev.png" type="image/x-icon">
    <!-- Fallback script for blog posts -->
    <script src="blog-fallback.js" type="module"></script>
    
    <!-- SEO Meta Tags (will be updated dynamically) -->
    <title>Blog Post | Hrvoje Matosevic</title>
    <meta name="description" content="Read my latest blog post about web development and tech insights." />
    <meta name="keywords" content="blog, web development, full-stack, developer" />
    <meta name="author" content="Hrvoje Matosevic" />
    
    <!-- Open Graph / Social Media Meta Tags (will be updated dynamically) -->
    <meta property="og:title" content="Blog Post | Hrvoje Matosevic" />
    <meta property="og:description" content="Read my latest blog post about web development and tech insights." />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="/hero_profile.jpg" />
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Import existing CSS -->
    <link rel="stylesheet" href="/styles/modern-normalize.css">
    <link rel="stylesheet" href="/styles/colors.css">
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="/styles/components/header.css">
    <link rel="stylesheet" href="/styles/components/footer.css">
    <link rel="stylesheet" href="/styles/components/mobile-nav.css">
    <link rel="stylesheet" href="/styles/utils.css">
    
    <!-- Code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <!-- Blog-specific styles -->
    <style>
      /* Loader styles */
      .loader-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: var(--color-slate-900);
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      }
      
      /* Progressive content loading */
      .content-section {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
      }
      
      .content-section.loaded {
        opacity: 1;
        transform: translateY(0);
      }
      
      /* Staggered load effect */
      .content-section:nth-child(1) { transition-delay: 0.1s; }
      .content-section:nth-child(2) { transition-delay: 0.2s; }
      .content-section:nth-child(3) { transition-delay: 0.3s; }
      
      /* Show header and navigation immediately */
      header, .header, nav, .mobile-nav {
        opacity: 1 !important;
        transform: none !important;
      }
      
      /* Styling for initial loading state */
      body.loading-start {
        overflow: hidden;
      }
      
      .light-mode .loader-container {
        background-color: white;
        background-image: linear-gradient(to bottom, #f8fafc, white);
      }
      
      .loader-container.hidden {
        opacity: 0;
        visibility: hidden;
      }
      
      .loader {
        width: 80px;
        height: 80px;
        position: relative;
      }
      
      .loader-circle {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 4px solid transparent;
        border-top-color: var(--color-primary);
        animation: spin 1.2s linear infinite;
      }
      
      .loader-circle:nth-child(2) {
        width: 70%;
        height: 70%;
        top: 15%;
        left: 15%;
        border-top-color: var(--color-slate-300);
        animation-direction: reverse;
        animation-duration: 0.8s;
      }
      
      .loader-circle:nth-child(3) {
        width: 40%;
        height: 40%;
        top: 30%;
        left: 30%;
        border-top-color: var(--color-slate-500);
        animation-duration: 0.6s;
      }
      
      .loader-logo {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--color-slate-200);
        font-weight: bold;
        font-size: 18px;
      }
      
      .light-mode .loader-logo {
        color: var(--color-slate-700);
      }
      
      :root {
        --clr-red: #E30613;    /* Croatian red */
        --clr-white: #ffffff;  /* White */
        --clr-blue: #0C4EA2;   /* Croatian blue */
        --clr-gold: #D4AF37;   /* Gold */
        --clr-blue-light: #3A78CA; /* Lighter blue for dark mode */
        --clr-slate400: #94a3b8;
        --clr-slate600: #475569;
        --clr-slate800: #1e293b;
        --clr-primary: var(--clr-blue);
        --clr-secondary: var(--clr-red);
        --clr-dark: white;
        --clr-light: #070a13;
        --transition-fast: 0.2s ease;
      }
      
      /* Blog post container */
      .blog-post {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }
      
      /* Blog post header */
      .blog-post__header {
        margin-bottom: 2rem;
      }
      
      .blog-post__title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--clr-primary);
        line-height: 1.2;
      }
      
      .light-mode .blog-post__title {
        color: var(--clr-light);
      }
      
      .blog-post__meta {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 1.5rem;
        color: var(--clr-slate400);
        font-size: 0.9rem;
      }
      
      .blog-post__meta > div {
        margin-right: 1.5rem;
        display: flex;
        align-items: center;
      }
      
      .blog-post__meta i {
        margin-right: 0.5rem;
      }
      
      .blog-post__tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }
      
      .blog-tag {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--clr-dark);
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      .light-mode .blog-tag {
        background-color: rgba(0, 0, 0, 0.05);
        color: var(--clr-slate800);
      }
      
      /* Featured image */
      .blog-post__image {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 2rem;
        max-height: 500px;
        object-fit: cover;
      }
      
      /* Blog post content */
      .blog-post__content {
        line-height: 1.8;
        color: var(--clr-dark);
        font-size: 1.05rem;
      }
      
      .light-mode .blog-post__content {
        color: var(--clr-light);
      }
      
      .blog-post__content h2 {
        font-size: 1.75rem;
        color: var(--clr-primary);
        margin-top: 2.5rem;
        margin-bottom: 1rem;
      }
      
      .light-mode .blog-post__content h2 {
        color: var(--clr-light);
      }
      
      .blog-post__content h3 {
        font-size: 1.5rem;
        color: var(--clr-primary);
        margin-top: 2rem;
        margin-bottom: 0.75rem;
      }
      
      .light-mode .blog-post__content h3 {
        color: var(--clr-light);
      }
      
      .blog-post__content p {
        margin-bottom: 1.5rem;
      }
      
      .blog-post__content a {
        color: var(--clr-primary);
        text-decoration: none;
      }
      
      .blog-post__content a:hover {
        text-decoration: underline;
      }
      
      .blog-post__content ul, .blog-post__content ol {
        margin-bottom: 1.5rem;
        padding-left: 1.5rem;
      }
      
      .blog-post__content li {
        margin-bottom: 0.5rem;
      }
      
      .blog-post__content img {
        max-width: 100%;
        border-radius: 4px;
        margin: 1.5rem 0;
      }
      
      .blog-post__content blockquote {
        border-left: 4px solid var(--clr-primary);
        padding-left: 1rem;
        margin-left: 0;
        margin-right: 0;
        margin-bottom: 1.5rem;
        font-style: italic;
        color: var(--clr-slate600);
      }
      
      .light-mode .blog-post__content blockquote {
        color: var(--clr-slate600);
      }
      
      .blog-post__content pre {
        background-color: #282c34;
        border-radius: 4px;
        padding: 1rem;
        overflow-x: auto;
        margin-bottom: 1.5rem;
      }
      
      .blog-post__content code {
        font-family: Consolas, Monaco, 'Andale Mono', monospace;
        font-size: 0.9rem;
      }
      
      .blog-post__content code:not(pre > code) {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 0.2em 0.4em;
        border-radius: 3px;
        color: var(--clr-dark);
      }
      
      .light-mode .blog-post__content code:not(pre > code) {
        background-color: rgba(0, 0, 0, 0.05);
        color: var(--clr-slate800);
      }
      
      .blog-post__content table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
      }
      
      .blog-post__content th, .blog-post__content td {
        padding: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .light-mode .blog-post__content th, .light-mode .blog-post__content td {
        border-color: var(--clr-slate400);
      }
      
      .blog-post__content th {
        background-color: rgba(255, 255, 255, 0.05);
        font-weight: 600;
      }
      
      .light-mode .blog-post__content th {
        background-color: rgba(0, 0, 0, 0.05);
      }
      
      /* Post navigation */
      .blog-post__nav {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-top: 3rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .light-mode .blog-post__nav {
        border-color: var(--clr-slate400);
      }
      
      .blog-post__nav-item {
        display: flex;
        flex-direction: column;
      }
      
      .blog-post__nav-item--next {
        text-align: right;
      }
      
      .blog-post__nav-label {
        font-size: 0.875rem;
        color: var(--clr-slate400);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
      }
      
      .blog-post__nav-item--prev .blog-post__nav-label {
        justify-content: flex-start;
      }
      
      .blog-post__nav-item--next .blog-post__nav-label {
        justify-content: flex-end;
      }
      
      .blog-post__nav-label i {
        margin: 0 0.5rem;
      }
      
      .blog-post__nav-title {
        font-weight: 500;
        color: var(--clr-primary);
        transition: color 0.2s ease;
      }
      
      .light-mode .blog-post__nav-title {
        color: var(--clr-light);
      }
      
      .blog-post__nav-link {
        text-decoration: none;
      }
      
      .blog-post__nav-link:hover .blog-post__nav-title {
        color: var(--clr-secondary);
      }
      
      .blog-post__back {
        text-align: center;
        margin-top: 2rem;
      }
      
      .blog-post__back-link {
        display: inline-flex;
        align-items: center;
        color: var(--clr-primary);
        text-decoration: none;
        font-weight: 500;
      }
      
      .blog-post__back-link:hover {
        text-decoration: underline;
      }
      
      .blog-post__back-link i {
        margin-right: 0.5rem;
      }
      
      .blog-post__author-socials {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
        margin-bottom: 1rem;
      }
      
      .blog-post__author-social {
        display: inline-flex;
        align-items: center;
        color: var(--clr-primary);
        font-size: 0.9rem;
        text-decoration: none;
        padding: 0.5rem 0.75rem;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 999px;
        transition: all 0.2s ease;
      }
      
      .blog-post__author-social:hover {
        color: var(--clr-secondary);
        background-color: rgba(255, 255, 255, 0.1);
      }
      
      .blog-post__author-social i {
        margin-right: 0.5rem;
      }
      
      /* Share buttons */
      .blog-post__share {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
      }
      
      .blog-post__share-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: white;
        transition: opacity 0.2s ease;
      }
      
      .blog-post__share-btn:hover {
        opacity: 0.8;
      }
      
      .blog-post__share-btn--twitter {
        background-color: #1DA1F2;
      }
      
      .blog-post__share-btn--facebook {
        background-color: #4267B2;
      }
      
      .blog-post__share-btn--linkedin {
        background-color: #0077B5;
      }
      
      /* Loading state */
      .loading {
        text-align: center;
        padding: 3rem 0;
        color: var(--clr-slate400);
        font-size: 1.1rem;
      }
      
      .loading i {
        margin-right: 0.5rem;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      /* Ensure the loading spinner animation doesn't conflict with loader's spin animation */
      .loading i {
        animation-name: spin-loading;
      }
      
      @keyframes spin-loading {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      /* Ensure the loading spinner animation doesn't conflict with loader's spin animation */
      .loading i {
        animation-name: spin-loading;
      }
      
      @keyframes spin-loading {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      /* Error state */
      .error {
        text-align: center;
        padding: 3rem 0;
        color: var(--clr-dark);
      }
      
      .light-mode .error {
        color: var(--clr-light);
      }
      
      .error__title {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      
      .error__message {
        color: var(--clr-slate400);
        margin-bottom: 2rem;
      }
      
      /* Table of Contents */
      .blog-post__toc {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
      
      .light-mode .blog-post__toc {
        background-color: rgba(0, 0, 0, 0.05);
      }
      
      .blog-post__toc-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--clr-primary);
      }
      
      .light-mode .blog-post__toc-title {
        color: var(--clr-light);
      }
      
      .blog-post__toc-list {
        list-style-type: none;
        padding-left: 0;
        margin-bottom: 0;
      }
      
      .blog-post__toc-list li {
        margin-bottom: 0.5rem;
      }
      
      .blog-post__toc-list a {
        text-decoration: none;
        color: var(--clr-dark);
        transition: color 0.2s ease;
      }
      
      .light-mode .blog-post__toc-list a {
        color: var(--clr-slate600);
      }
      
      .blog-post__toc-list a:hover {
        color: var(--clr-primary);
      }
      
      .blog-post__toc-list ul {
        list-style-type: none;
        padding-left: 1.5rem;
        margin-top: 0.5rem;
      }
      
      /* Responsive adjustments */
      @media (max-width: 768px) {
        .blog-post__title {
          font-size: 2rem;
        }
        
        .blog-post__nav {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
        
        .blog-post__nav-item--next {
          text-align: left;
        }
        
        .blog-post__nav-item--next .blog-post__nav-label {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body class="loading-start">
    <!-- Page loader -->
    <div class="loader-container">
      <div class="loader">
        <div class="loader-circle"></div>
        <div class="loader-circle"></div>
        <div class="loader-circle"></div>
        <div class="loader-logo">HM</div>
      </div>
    </div>
    <!-- Header from main site -->
    <header class="header container">
      <nav>
        <div class="logo">HM</div>
        <ul class="header__menu">
          <li class="header__link">
            <a href="/">Home</a>
          </li>
          <li class="header__link">
            <a href="/#about">About</a>
          </li>
          <li class="header__link">
            <a href="/#featured">My Work</a>
          <li class="header__link">
            <a href="/blog.html" class="active">Blog</a>
          </li>
          <li class="header__link">
            <a href="mailto:hrvoje.matos@gmail.com?subject=Hire Your Own Personal Dev - Hrvoje">Contact</a>
          </li>
          <li class="header__line">
          </li>
          <li>
            <button id="theme-toggle" class="header__sun header__right">
              <i class="fas fa-sun"></i>
            </button>
          </li>
          <li>
            <a class="header__resume btn" href="https://docs.google.com/document/d/10Hsqj77TU0mlnabOsM-vtufpVTKeOMWb/edit?usp=sharing&ouid=116524350403006719529&rtpof=true&sd=true" target="_blank">My Resume</a>
          </li>
        </ul>
        <button class="header__bars">
          <i class="fas fa-bars"></i>
        </button>
      </nav>
    </header>
    
    <!-- Mobile Navigation -->
    <div class="mobile-nav">
      <div class="mobile-nav__close">
        <i class="fas fa-times"></i>
      </div>
      <nav>
        <ul class="mobile-nav__menu">
          <li>
            <a class="mobile-nav__link" href="/">Home</a>
          </li>
          <li>
            <a class="mobile-nav__link" href="/#about">About</a>
          </li>
          <li>
            <a class="mobile-nav__link" href="/#featured">Work</a>
          </li>
          <li>
            <a class="mobile-nav__link active" href="/blog.html">Blog</a>
          </li>
          <li>
            <a class="mobile-nav__link" href="/#contact">Contact</a>
          </li>
          <li class="mobile-nav__link-line"></li>
          <li>
            <button id="mobile-theme-toggle" class="mobile-nav__sun">
              <i class="fas fa-sun"></i>
            </button>
          </li>
          <li>
            <a class="mobile-nav__btn btn" href="https://docs.google.com/document/d/10Hsqj77TU0mlnabOsM-vtufpVTKeOMWb/edit?usp=sharing&ouid=116524350403006719529&rtpof=true&sd=true" target="_blank">Resume</a>
          </li>
        </ul>
      </nav>
    </div>
    
    <main>
      <article class="blog-post container section" id="blog-post">
        <div class="loading">
          <i class="fas fa-spinner"></i> Loading blog post...
        </div>
      </article>
    </main>
    
    <!-- Footer from main site -->
    <footer class="footer container section">
      <div class="footer__content">
        <h3 class="footer__title">Hrvoje Matosevic</h3>
        <p class="footer__copyright">&copy; 2025 All rights reserved</p>
      </div>
      <div class="footer__links">
        <a href="/" class="footer__link">Home</a>
        <a href="/#about" class="footer__link">About</a>
        <a href="/#featured" class="footer__link">Work</a>
        <a href="/blog.html" class="footer__link">Blog</a>
        <a href="/#contact" class="footer__link">Contact</a>
      </div>
      <div class="footer__social" style="margin-top: 15px;">
        <a href="https://www.linkedin.com/in/hrvoje-matt/" target="_blank" style="margin-right: 15px;"><i class="fab fa-linkedin"></i></a>
        <a href="https://x.com/CtrlAltDeMatt" target="_blank"><i class="fab fa-twitter"></i></a>
      </div>
    </footer>
    
    <script>
      // Constants
      const BLOG_API = '/api/blog.php'; // Simple blog API endpoint
      
      // DOM elements
      const blogPostContainer = document.getElementById('blog-post');
      
      // Get post ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get('id');
      
      // Format date helper
      function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
      }
      
      // Convert markdown to HTML
      function markdownToHtml(markdown) {
        if (!markdown) return '';
        
        // Process code blocks with syntax highlighting
        markdown = markdown.replace(/```(\w+)?\n([\s\S]+?)```/g, (match, language, code) => {
          return `<pre><code class="language-${language || 'plaintext'}">${code.trim()}</code></pre>`;
        });
        
        // Process headers
        markdown = markdown.replace(/^### (.*$)/gim, '<h3 id="$1">$1</h3>');
        markdown = markdown.replace(/^## (.*$)/gim, '<h2 id="$1">$1</h2>');
        markdown = markdown.replace(/^# (.*$)/gim, '<h1 id="$1">$1</h1>');
        
        // Process bold and italic
        markdown = markdown.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        markdown = markdown.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Process lists
        markdown = markdown.replace(/^\s*\n\* (.*)/gm, '<ul>\n<li>$1</li>');
        markdown = markdown.replace(/^\* (.*)/gm, '<li>$1</li>');
        markdown = markdown.replace(/^\s*\n<\/ul>/gm, '</ul>');
        markdown = markdown.replace(/^\s*\n\d\. (.*)/gm, '<ol>\n<li>$1</li>');
        markdown = markdown.replace(/^\d\. (.*)/gm, '<li>$1</li>');
        markdown = markdown.replace(/^\s*\n<\/ol>/gm, '</ol>');
        
        // Process links and images
        markdown = markdown.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
        markdown = markdown.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">');
        
        // Process blockquotes
        markdown = markdown.replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>');
        
        // Process paragraphs
        markdown = markdown.replace(/^\s*(\n)?(.+)/gm, function(m) {
          return /\<(\/)?(h\d|ul|ol|li|blockquote|pre|img)/.test(m) ? m : '<p>' + m + '</p>';
        });
        
        // Process line breaks
        markdown = markdown.replace(/\n/g, '<br>');
        
        return markdown;
      }
      
      // Generate table of contents from HTML content
      function generateTableOfContents(htmlContent) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlContent;
        
        const headings = tempDiv.querySelectorAll('h2, h3');
        if (headings.length < 3) return ''; // Don't show TOC if there are fewer than 3 headings
        
        let toc = '<div class="blog-post__toc">';
        toc += '<h4 class="blog-post__toc-title">Table of Contents</h4>';
        toc += '<ul class="blog-post__toc-list">';
        
        let currentH2 = null;
        let hasSubHeadings = false;
        
        headings.forEach(heading => {
          const id = heading.id || heading.textContent.toLowerCase().replace(/[^\w]+/g, '-');
          heading.id = id;
          
          if (heading.tagName === 'H2') {
            if (currentH2 !== null && hasSubHeadings) {
              toc += '</ul></li>';
            }
            toc += `<li><a href="#${id}">${heading.textContent}</a>`;
            currentH2 = id;
            hasSubHeadings = false;
          } else if (heading.tagName === 'H3' && currentH2 !== null) {
            if (!hasSubHeadings) {
              toc += '<ul>';
              hasSubHeadings = true;
            }
            toc += `<li><a href="#${id}">${heading.textContent}</a></li>`;
          }
        });
        
        if (hasSubHeadings) {
          toc += '</ul></li>';
        } else if (currentH2 !== null) {
          toc += '</li>';
        }
        
        toc += '</ul></div>';
        return toc;
      }
      
      // Fetch and display blog post
      async function fetchPost() {
        if (!postId) {
          showError('Post not found', 'The blog post you requested could not be found.');
          return;
        }
        
        try {
          // Fetch single post from API
          console.log(`Fetching post from API: ${BLOG_API}?id=${postId}`);
          const response = await fetch(`${BLOG_API}?id=${postId}`);
          
          if (!response.ok) {
            console.error('API error:', response.status, response.statusText);
            throw new Error('Post not found');
          }
          
          const post = await response.json();
          displayPost(post);
          fetchRelatedPosts(post);
        } catch (error) {
          console.error('Error fetching post:', error);
          
          // Try using fallback data
          if (typeof getBlogFallbackData === 'function') {
            console.log('Trying fallback data for post:', postId);
            const fallbackData = getBlogFallbackData();
            const fallbackPost = fallbackData.find(post => post.id === postId);
            
            if (fallbackPost) {
              console.log('Found post in fallback data');
              displayPost(fallbackPost);
              fetchRelatedPostsFromAllPosts(fallbackPost, fallbackData);
              return;
            }
          }
          
          showError('Post not found', 'The blog post you requested could not be found.');
        }
      }
      
      // Fetch related posts from the list of all posts (when using fallback)
      function fetchRelatedPostsFromAllPosts(currentPost, allPosts) {
        try {
          // Find current post index
          const currentIndex = allPosts.findIndex(post => post.id === currentPost.id);
          
          if (currentIndex === -1) return;
          
          const prevPost = currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
          const nextPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
          
          const navContainer = document.getElementById('post-navigation');
          navContainer.innerHTML = '';
          
          if (prevPost) {
            navContainer.innerHTML += `
              <div class="blog-post__nav-item blog-post__nav-item--prev">
                <a href="/blog-post.html?id=${prevPost.id}" class="blog-post__nav-link">
                  <div class="blog-post__nav-label">
                    <i class="fas fa-arrow-left"></i> Previous Post
                  </div>
                  <div class="blog-post__nav-title">${prevPost.title}</div>
                </a>
              </div>
            `;
          } else {
            navContainer.innerHTML += `<div class="blog-post__nav-item"></div>`;
          }
          
          if (nextPost) {
            navContainer.innerHTML += `
              <div class="blog-post__nav-item blog-post__nav-item--next">
                <a href="/blog-post.html?id=${nextPost.id}" class="blog-post__nav-link">
                  <div class="blog-post__nav-label">
                    Next Post <i class="fas fa-arrow-right"></i>
                  </div>
                  <div class="blog-post__nav-title">${nextPost.title}</div>
                </a>
              </div>
            `;
          } else {
            navContainer.innerHTML += `<div class="blog-post__nav-item"></div>`;
          }
        } catch (error) {
          console.error('Error setting up related posts from all posts:', error);
        }
      }
      
      // Display blog post
      function displayPost(post) {
        // Update page title and meta tags
        document.title = `${post.title} | Hrvoje Matosevic`;
        document.querySelector('meta[name="description"]').setAttribute('content', post.excerpt);
        document.querySelector('meta[property="og:title"]').setAttribute('content', post.title);
        document.querySelector('meta[property="og:description"]').setAttribute('content', post.excerpt);
        document.querySelector('meta[property="og:url"]').setAttribute('content', window.location.href);
        
        if (post.image) {
          document.querySelector('meta[property="og:image"]').setAttribute('content', post.image);
        }
        
        // Process content
        const htmlContent = markdownToHtml(post.content);
        const toc = generateTableOfContents(htmlContent);
        
        // Format date
        const formattedDate = formatDate(post.date);
        
        // Build post HTML
        blogPostContainer.innerHTML = `
          <header class="blog-post__header">
            <h1 class="blog-post__title">${post.title}</h1>
            <div class="blog-post__meta">
              <div class="blog-post__author">
                <i class="fas fa-user"></i> ${post.author}
              </div>
              <div class="blog-post__date">
                <i class="far fa-calendar-alt"></i> ${formattedDate}
              </div>
            </div>
            <div class="blog-post__author-socials">
              <a href="https://x.com/CtrlAltDeMatt" target="_blank" class="blog-post__author-social">
                <i class="fab fa-twitter"></i> @CtrlAltDeMatt
              </a>
              <a href="https://www.linkedin.com/in/hrvoje-matt/" target="_blank" class="blog-post__author-social">
                <i class="fab fa-linkedin"></i> Hrvoje Matosevic
              </a>
            </div>
            <div class="blog-post__tags">
              ${post.tags.map(tag => `<span class="blog-tag">${tag}</span>`).join('')}
            </div>
          </header>
          
          ${post.image ? `<img class="blog-post__image" src="${post.image}" alt="${post.title}">` : ''}
          
          ${toc}
          
          <div class="blog-post__content">
            ${htmlContent}
          </div>
          
          <div class="blog-post__share">
            <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(post.title)}" target="_blank" class="blog-post__share-btn blog-post__share-btn--twitter">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank" class="blog-post__share-btn blog-post__share-btn--facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}" target="_blank" class="blog-post__share-btn blog-post__share-btn--linkedin">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
          
          <div class="blog-post__back">
            <a href="/blog.html" class="blog-post__back-link">
              <i class="fas fa-arrow-left"></i> Back to Blog
            </a>
          </div>
          
          <div class="blog-post__nav" id="post-navigation">
            <!-- Will be populated with related posts -->
          </div>
        `;
        
        // Initialize code highlighting
        document.querySelectorAll('pre code').forEach(block => {
          hljs.highlightBlock(block);
        });
      }
      
      // Fetch related posts for navigation
      async function fetchRelatedPosts(currentPost) {
        try {
          // Fetch all posts to find related ones
          const response = await fetch(BLOG_API);
          
          if (!response.ok) {
            throw new Error('Failed to fetch related posts');
          }
          
          const posts = await response.json();
          setupRelatedPostsNavigation(posts, currentPost);
        } catch (error) {
          console.error('Error fetching related posts:', error);
          // Try fetching from fallback source
          try {
            if (typeof getBlogFallbackData === 'function') {
              console.log('Using fallback blog data for related posts');
              const fallbackData = getBlogFallbackData();
              setupRelatedPostsNavigation(fallbackData, currentPost);
            }
          } catch (fallbackError) {
            console.error('Error using fallback data:', fallbackError);
          }
        }
      }
      
      // Set up the previous/next navigation for blog posts
      function setupRelatedPostsNavigation(posts, currentPost) {
        // Find current post index
        const currentIndex = posts.findIndex(post => post.id === currentPost.id);
        
        if (currentIndex === -1) return;
        
        const prevPost = currentIndex < posts.length - 1 ? posts[currentIndex + 1] : null;
        const nextPost = currentIndex > 0 ? posts[currentIndex - 1] : null;
        
        const navContainer = document.getElementById('post-navigation');
        navContainer.innerHTML = '';
        
        if (prevPost) {
          navContainer.innerHTML += `
            <div class="blog-post__nav-item blog-post__nav-item--prev">
              <a href="/blog-post.html?id=${prevPost.id}" class="blog-post__nav-link">
                <div class="blog-post__nav-label">
                  <i class="fas fa-arrow-left"></i> Previous Post
                </div>
                <div class="blog-post__nav-title">${prevPost.title}</div>
              </a>
            </div>
          `;
        } else {
          navContainer.innerHTML += `<div class="blog-post__nav-item"></div>`;
        }
        
        if (nextPost) {
          navContainer.innerHTML += `
            <div class="blog-post__nav-item blog-post__nav-item--next">
              <a href="/blog-post.html?id=${nextPost.id}" class="blog-post__nav-link">
                <div class="blog-post__nav-label">
                  Next Post <i class="fas fa-arrow-right"></i>
                </div>
                <div class="blog-post__nav-title">${nextPost.title}</div>
              </a>
            </div>
          `;
        } else {
          navContainer.innerHTML += `<div class="blog-post__nav-item"></div>`;
        }
      }
      
      // Show error message
      function showError(title, message) {
        blogPostContainer.innerHTML = `
          <div class="error">
            <h2 class="error__title">${title}</h2>
            <p class="error__message">${message}</p>
            <a href="/blog.html" class="btn">Back to Blog</a>
          </div>
        `;
      }
      
      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        // Mark main content sections for progressive loading
        const contentSections = [
          '.blog-post__header',
          '.blog-post__image',
          '.blog-post__content',
          '.blog-post__share',
          '.blog-post__nav',
          'footer'
        ];
        
        contentSections.forEach(selector => {
          const elements = document.querySelectorAll(selector);
          elements.forEach(el => el.classList.add('content-section'));
        });
        
        // Track image loading progress
        let imagesLoaded = 0;
        const imagesToLoad = document.querySelectorAll('img').length;
        
        function imageLoaded() {
          imagesLoaded++;
          const progress = imagesLoaded / imagesToLoad;
          
          // When all images are loaded, remove loader
          if (progress >= 1) {
            removeLoader();
          }
        }
        
        // If no images, just remove loader after a minimum time
        if (imagesToLoad === 0) {
          setTimeout(removeLoader, 800);
        } else {
          // Track image loading progress
          document.querySelectorAll('img').forEach(img => {
            // For already loaded or cached images
            if (img.complete) {
              imageLoaded();
            } else {
              // For images still loading
              img.addEventListener('load', imageLoaded);
              img.addEventListener('error', imageLoaded); // Count errors as loaded
            }
          });
        }
        
        function removeLoader() {
          // Short delay to ensure a minimum loading time for better UX
          setTimeout(() => {
            // Make sure all sections are revealed
            document.querySelectorAll('.content-section').forEach(section => {
              section.classList.add('loaded');
            });
            
            // Remove loader with fade out
            const loaderContainer = document.querySelector('.loader-container');
            if (loaderContainer) {
              loaderContainer.classList.add('hidden');
              
              // Remove loader after transition
              setTimeout(() => {
                loaderContainer.remove();
              }, 500);
            }
          }, 600);
        }
        
        // If everything else fails, remove loader after a timeout
        setTimeout(() => {
          document.body.classList.remove('loading-start');
          document.querySelectorAll('.content-section').forEach(section => {
            section.classList.add('loaded');
          });
          removeLoader();
        }, 5000);
        // Fetch blog post
        fetchPost();
        
        // Initialize mobile navigation
        const mobileNavToggle = document.querySelector('.header__bars');
        const mobileNavClose = document.querySelector('.mobile-nav__close');
        const mobileNav = document.querySelector('.mobile-nav');
        
        if (mobileNavToggle) {
          mobileNavToggle.addEventListener('click', () => {
            mobileNav.classList.add('active');
          });
        }
        
        if (mobileNavClose) {
          mobileNavClose.addEventListener('click', () => {
            mobileNav.classList.remove('active');
          });
        }
        
        // Initialize theme toggle
        const themeToggleBtns = document.querySelectorAll('#theme-toggle, #mobile-theme-toggle');
        
        // Check for saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
          document.body.classList.add('light-mode');
          themeToggleBtns.forEach(btn => {
            const icon = btn.querySelector('i');
            if (icon) {
              icon.classList.remove('fa-sun');
              icon.classList.add('fa-moon');
            }
          });
        }
        
        // Add theme toggle functionality
        themeToggleBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            
            themeToggleBtns.forEach(btn => {
              const icon = btn.querySelector('i');
              if (icon) {
                icon.classList.toggle('fa-sun');
                icon.classList.toggle('fa-moon');
              }
            });
            
            // Save theme preference
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
          });
        });
      });
    </script>
  </body>
</html>